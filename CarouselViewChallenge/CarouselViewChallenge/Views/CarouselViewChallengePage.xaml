<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:CarouselViewChallenge.ViewModels"
             xmlns:ff="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             xmlns:ffs="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms" 
             xmlns:behaviors="clr-namespace:CarouselViewChallenge.Behaviors"
             mc:Ignorable="d"
             x:Name="_"
             x:Class="CarouselViewChallenge.Views.CarouselViewChallengePage"
             xmlns:rainbows="clr-namespace:Xamarin.Forms.DebugRainbows;assembly=Xamarin.Forms.DebugRainbows" 
             rainbows:DebugRainbow.IsDebug="false" 
             >
    <ContentPage.BindingContext>
        <local:CarouselViewChallengeViewModel />
    </ContentPage.BindingContext>
    <ContentPage.Resources>
        <Color x:Key="PrimaryLavendarDark">#8E88FF</Color>
        <Color x:Key="PrimaryPurpleDark">#231E51</Color>

        <Style x:Key="BaseHeading" TargetType="Label">
            <Setter Property="FontFamily" Value="{StaticResource SemiBoldFont}" />
            <Setter Property="TextColor" Value="{StaticResource PrimaryPurpleDark}" />
        </Style>

        <Style x:Key="H2Heading" TargetType="Label" BasedOn="{StaticResource BaseHeading}">
            <Setter Property="FontSize" Value="22" />
            <Setter Property="LineHeight" Value="1.03" />
        </Style>
        
        <Style x:Key="H2Center" TargetType="Label" BasedOn="{StaticResource H2Heading}">
            <Setter Property="HorizontalTextAlignment" Value="Center" />
        </Style>
        
        <Style x:Key="H3Heading" TargetType="Label" BasedOn="{StaticResource BaseHeading}">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="LineHeight" Value="1.03" />
        </Style>
        <Style x:Key="H3Center" TargetType="Label" BasedOn="{StaticResource H3Heading}">
            <Setter Property="HorizontalTextAlignment" Value="Center" />
        </Style>


        <Style x:Key="BaseButton" TargetType="Button">
            <Setter Property="FontFamily" Value="{StaticResource MediumFont}" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="CornerRadius" Value="25" />
            <Setter Property="HeightRequest" Value="50" />
            <Setter Property="Padding" Value="20, 0, 20, 0" />
            <Setter Property="HorizontalOptions" Value="Center" />
        </Style>

        <Style x:Key="ButtonLavendar" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="BackgroundColor" Value="{StaticResource PrimaryLavendarDark}" />
            <Setter Property="WidthRequest" Value="265" />
        </Style>

        <Style x:Key="LabelButtonLavendar" TargetType="Label">
            <Setter Property="FontFamily" Value="{StaticResource MediumFont}" />
            <Setter Property="BackgroundColor" Value="{StaticResource PrimaryLavendarDark}" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="HeightRequest" Value="50" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
            <Setter Property="VerticalTextAlignment" Value="Center" />
        </Style>
        <DataTemplate x:Key="StayInformedCard">
            <Frame CornerRadius="40"
                   HeightRequest="318"
                   WidthRequest="265"
                   VerticalOptions="CenterAndExpand"
                   HorizontalOptions="Center"
                   Padding="0"
                   HasShadow="True"
                   IsClippedToBounds="True">
                <Grid>
                    <ff:CachedImage Source="{Binding Image, StringFormat='resource://CarouselViewChallenge.Resources.{0}.jpg'}"
                                    Aspect="AspectFill"
                                    Margin="0,0,0,50"/>
                    <Label Text="&#9654;"
                           FontSize="80"
                           TextColor="White"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="15, 25, 0, 50"/>

                    <Label Text="{Binding Title}" Style="{StaticResource LabelButtonLavendar}"
                           HeightRequest="50"
                           VerticalOptions="End" />
                    <Grid.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding BindingContext.NavigateToVideoEmbedCommand, Source={x:Reference _}}" CommandParameter="https://www.youtube.com/embed/_vX_a3X2i5c" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
        </DataTemplate>
    </ContentPage.Resources>
    <ContentPage.Content>
        <ScrollView>
            <StackLayout Spacing="0">
                <!-- Polls Section -->
                <Label Text="Polls"
                       Style="{StaticResource H2Heading}"
                       VerticalOptions="Start"                       
                       Margin="20, 50, 20, 0"/>

                <Grid HeightRequest="345"
                      Padding="0">

                    <ffs:SvgCachedImage Source="resource://CarouselViewChallenge.Resources.bg_swoosh_aqua.svg"
                                        WidthRequest="266"
                                        HeightRequest="275"
                                        HorizontalOptions="End"
                                        VerticalOptions="End"
                                        Aspect="Fill" />

                    <StackLayout VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Spacing="0">
                        <Label
                            Text="Thanks for answering!"
                            Style="{StaticResource H2Center}"
                            WidthRequest="265"/>
                        <Label
                            Text="We'll let you know when we have more polls."
                            Style="{StaticResource H3Center}"
                            WidthRequest="265"
                            Margin="0, 15, 0, 0"/>
                        <Button Text="Introducing: CA points"
                                Style="{StaticResource ButtonLavendar}"
                                Margin="0, 40, 0, 40">
                            <Button.CornerRadius>
                                <OnPlatform x:TypeArguments="x:Int32">
                                    <On Platform="Android" Value="40" />
                                    <On Platform="iOS" Value="25" />
                                </OnPlatform>
                            </Button.CornerRadius>
                        </Button>
                    </StackLayout>

                </Grid>

                <!-- Stay Informed Card Section -->
                <Grid HeightRequest="478"
                      VerticalOptions="Start">
                    <ff:CachedImage VerticalOptions="FillAndExpand"
                                    HorizontalOptions="FillAndExpand"
                                    Aspect="AspectFill"
                                    Source="resource://CarouselViewChallenge.Resources.bg_stay_informed.png" />
            
                    <Label Text="Stay Informed"
                                       TextColor="White"
                                       HorizontalTextAlignment="Start"
                                       Style="{StaticResource H2Heading}"
                                       Margin="20, 32, 0, 0"/>

                    <CarouselView ItemsSource="{Binding Items}"
                                  PeekAreaInsets="50"
                                  ItemTemplate="{StaticResource StayInformedCard}"
                                  HeightRequest="368"
                                  VerticalOptions="Start"
                                  HorizontalOptions="End">

                        <CarouselView.Margin>
                            <OnPlatform x:TypeArguments="Thickness">
                                <On Platform="iOS" Value="0, 90, 0, 0" />
                                <On Platform="Android" Value="0, 90, 0, 0" />
                            </OnPlatform>
                        </CarouselView.Margin>
                        <CarouselView.PeekAreaInsets>
                            <OnPlatform x:TypeArguments="Thickness">
                                <On Platform="iOS" Value="0, 0, 70, 0" />
                                <On Platform="Android" Value="0, 0, 200, 0" />
                            </OnPlatform>
                        </CarouselView.PeekAreaInsets>

                        <CarouselView.ItemsLayout>
                            <ListItemsLayout
                                Orientation="Horizontal"
                                SnapPointsType="Mandatory"
                                SnapPointsAlignment="Center"
                                ItemSpacing="12"/>
                        </CarouselView.ItemsLayout>
                        
                        <CarouselView.Behaviors>
                            <behaviors:CarouselViewScrollBehavior />
                        </CarouselView.Behaviors>
                    </CarouselView>
                </Grid>
            </StackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>